var D=Object.defineProperty;var F=(s,e,t)=>e in s?D(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var b=(s,e,t)=>F(s,typeof e!="symbol"?e+"":e,t);import{d as U,a as j,b as G,e as V,r as h,f as x,w as E,c as y,g as m,M,o as _,h as I,i as r,u,N as S,j as O,k as T,l as $}from"./index-DBOuClg0.js";import{S as B,u as W,P as A,_ as J,a as q,b as z,c as H,d as K,e as X,f as Q}from"./index-Bpyc1kPi.js";const Y={rotate:1,rotate_var:.5,colorspace:"gray",blur:.3,noise:.1,border:!1,scale:2,brightness:1,yellowish:0,contrast:1,output_format:"image/jpeg"};function f(s){return new Worker("/assets/scan.worker-Dfe0nX2g.js",{name:s==null?void 0:s.name})}function Z(s){return`<svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"
  xmlns:svgjs="http://svgjs.dev/svgjs" viewBox="0 0 700 700" width="700" height="700">
  <defs>
      <filter id="nnnoise-filter" x="-20%" y="-20%" width="140%" height="140%" filterUnits="objectBoundingBox"
          primitiveUnits="userSpaceOnUse" color-interpolation-filters="linearRGB">
          <feTurbulence type="fractalNoise" baseFrequency="0.102" numOctaves="4" seed="15" stitchTiles="stitch" x="0%"
              y="0%" width="100%" height="100%" result="turbulence"></feTurbulence>
          <feSpecularLighting surfaceScale="15" specularConstant="${s*3}" specularExponent="20" lighting-color="#7957A8"
              x="0%" y="0%" width="100%" height="100%" in="turbulence" result="specularLighting">
              <feDistantLight azimuth="3" elevation="100"></feDistantLight>
          </feSpecularLighting>
          <feColorMatrix type="saturate" values="0" x="0%" y="0%" width="100%" height="100%" in="specularLighting"
              result="colormatrix"></feColorMatrix>
      </filter>
  </defs>
  <rect width="700" height="700" fill="transparent"></rect>
  <rect width="700" height="700" fill="#7957a8" filter="url(#nnnoise-filter)"></rect>
</svg>`}async function ee(s,e,t){const n=new OffscreenCanvas(t,e),d=n.getContext("2d");if(!d)throw new Error("Canvas context is null");if(s===0)return n.convertToBlob({type:"image/png"});const a=Z(s),c=new Blob([a],{type:"image/svg+xml"}),o=URL.createObjectURL(c),l=new Image;return l.src=o,await new Promise(i=>l.onload=i),d.drawImage(l,0,0,t,e),await n.convertToBlob({type:"image/png"})}const C=[new f,new f,new f,new f,new f],N=new Map;class k{constructor(e){b(this,"config");this.config=e}async renderPage(e,t){var c,o;if((c=t==null?void 0:t.signal)!=null&&c.aborted)throw new Error("Aborted");const n=C.shift()??new f;C.push(new f),(o=t==null?void 0:t.signal)==null||o.addEventListener("abort",()=>n.terminate());const d=await ne(this.config.noise);return{blob:await new Promise((l,v)=>{n.onmessage=i=>{l(i.data),n.terminate()},n.onerror=i=>{console.error(i),v(i),n.terminate()},n.postMessage({page:e,config:JSON.parse(JSON.stringify(this.config)),noise:d})})}}}async function ne(s){const e=s.toFixed(2),t=N.get(e);if(t)return t;const n=await ee(s,1e3,1e3);return N.set(e,n),n}const te={style:{"margin-bottom":"25px"}},oe=U({__name:"CanvasScanView",setup(s){const{t:e}=j(),t=G();V({title:e("base.scanTitle")+" - "+e("base.title"),meta:[{name:"description",content:e("base.description")}]});const n=h(void 0);(async()=>{const g=await(await fetch(A)).blob(),w=new File([g],"example.pdf");n.value||(n.value=w)})();const a=h(Y),c=x(()=>{if(n.value)return new Q(n.value)}),o=h(new B(new k(a.value)));E(a,p=>{o.value=new B(new k(p))},{deep:!0});const l=x(()=>a.value.scale),{save:v,progress:i,saving:L,scannedPDF:P}=W(n,c,o,l),R=async()=>{try{await v(),t.success(e("actions.generateSuccess"))}catch(p){t.error(e("actions.generateError")+p.message)}};return(p,g)=>(_(),y(M,null,{default:m(()=>[I("div",te,[r(J)]),r(u($),{"x-gap":"25","y-gap":"25",cols:12,"item-responsive":"",responsive:"screen"},{default:m(()=>[r(u(S),{span:"12 s:5 m:4 l:3"},{default:m(()=>[r(u(O),{vertical:""},{default:m(()=>[r(q,{"onUpdate:pdf":g[0]||(g[0]=w=>n.value=w)}),n.value?(_(),y(z,{key:0,pdf:n.value},null,8,["pdf"])):T("",!0),r(H,{config:a.value,"onUpdate:config":g[1]||(g[1]=w=>a.value=w)},null,8,["config"]),r(K,{onGenerate:R,progress:u(i),saving:u(L),pdf:u(P)},null,8,["progress","saving","pdf"])]),_:1})]),_:1}),r(u(S),{span:"12 s:7 m:8 l:9"},{default:m(()=>[r(X,{pdfRenderer:c.value,scanRenderer:o.value,scale:a.value.scale},null,8,["pdfRenderer","scanRenderer","scale"])]),_:1})]),_:1})]),_:1}))}});export{oe as _};
